# ğŸ¯ CURSOR RULES - Connect People Project

## ğŸ“‹ CONTEXTE DU PROJET
- **Projet**: Backend Node.js moderne en ES2023
- **Stack**: TypeScript + Express + MongoDB + Redis + Socket.io
- **Architecture**: ESM uniquement (pas de CommonJS)
- **Style**: Code en franÃ§ais (commentaires, variables, fonctions)
- **Version Node**: 20+ avec support ES2023

## ğŸ—ï¸ ARCHITECTURE & STRUCTURE

### Structure des dossiers
```
src/
â”œâ”€â”€ config/          # Configuration (DB, Redis, etc.)
â”œâ”€â”€ controllers/     # ContrÃ´leurs Express
â”œâ”€â”€ middlewares/     # Middlewares personnalisÃ©s
â”œâ”€â”€ models/          # ModÃ¨les Mongoose
â”œâ”€â”€ routes/          # Routes Express
â”œâ”€â”€ services/        # Logique mÃ©tier
â”œâ”€â”€ types/           # Types TypeScript
â”œâ”€â”€ utils/           # Utilitaires
â””â”€â”€ index.ts         # Point d'entrÃ©e
```

### Conventions de nommage
- **Fichiers**: kebab-case (`user-controller.ts`)
- **Classes**: PascalCase (`UserController`)
- **Fonctions/Variables**: camelCase (`getUserById`)
- **Constants**: UPPER_SNAKE_CASE (`MAX_RETRY_COUNT`)
- **Types/Interfaces**: PascalCase avec prÃ©fixe (`IUser`, `TUserRole`)

## ğŸ¨ STYLE DE CODE

### TypeScript
- **TOUJOURS** utiliser les imports ESM (`import/export`)
- **JAMAIS** de `require()` ou `module.exports`
- Types stricts obligatoires
- PrÃ©fÃ©rer les interfaces aux types pour les objets
- Utiliser les types utilitaires TypeScript

### Exemples de bonnes pratiques
```typescript
// âœ… BON - Import ESM
import { Router } from 'express';
import type { Request, Response } from 'express';

// âœ… BON - Interface avec types stricts
interface IUtilisateur {
  readonly id: string;
  nom: string;
  email: string;
  dateCreation: Date;
}

// âœ… BON - Fonction avec types explicites
export const obtenirUtilisateur = async (id: string): Promise<IUtilisateur | null> => {
  // Implementation
};

// âŒ MAUVAIS - CommonJS
const express = require('express');

// âŒ MAUVAIS - Types implicites
const getUser = (id) => {
  // Implementation
};
```

### Gestion d'erreurs
- Utiliser des classes d'erreur personnalisÃ©es
- Toujours typer les erreurs
- Logging structurÃ© avec Winston

```typescript
// âœ… BON
export class ErreurUtilisateurIntrouvable extends Error {
  constructor(id: string) {
    super(`Utilisateur avec l'ID ${id} introuvable`);
    this.name = 'ErreurUtilisateurIntrouvable';
  }
}
```

## ğŸ”§ OUTILS & CONFIGURATION

### Scripts NPM disponibles
- `npm run dev` - DÃ©veloppement avec watch
- `npm run build` - Build TypeScript
- `npm run test` - Tests Jest
- `npm run lint` - ESLint
- `npm run type-check` - VÃ©rification TypeScript

### Base de donnÃ©es
- **MongoDB** avec Mongoose
- **Redis** pour les sessions/cache
- SchÃ©mas Mongoose avec validation Zod

### Tests
- **Jest** avec TypeScript
- Tests unitaires dans `__tests__/unit/`
- Tests d'intÃ©gration dans `__tests__/integration/`
- Mocking avec `jest-mock-extended`

## ğŸš€ DIRECTIVES POUR L'IA

### Lors de l'Ã©criture de code
1. **TOUJOURS** Ã©crire en franÃ§ais (commentaires, noms de variables)
2. **TOUJOURS** utiliser ESM (import/export)
3. **TOUJOURS** typer strictement avec TypeScript
4. **TOUJOURS** valider les donnÃ©es avec Zod
5. **TOUJOURS** gÃ©rer les erreurs proprement
6. **TOUJOURS** ajouter des logs appropriÃ©s

### Lors de modifications
- Respecter l'architecture existante
- Maintenir la cohÃ©rence du style
- Ajouter des tests pour le nouveau code
- Mettre Ã  jour la documentation si nÃ©cessaire

### Patterns Ã  Ã©viter
- âŒ CommonJS (`require`, `module.exports`)
- âŒ `any` type (utiliser `unknown` si nÃ©cessaire)
- âŒ Mutations directes (prÃ©fÃ©rer l'immutabilitÃ©)
- âŒ Callbacks (utiliser async/await)
- âŒ Code en anglais (sauf APIs externes)

### Patterns Ã  favoriser
- âœ… Composition over inheritance
- âœ… Dependency injection
- âœ… Pure functions quand possible
- âœ… Error boundaries
- âœ… Validation stricte des inputs

## ğŸ”’ SÃ‰CURITÃ‰

### Obligatoire
- Validation Zod sur tous les inputs
- Sanitisation avec DOMPurify
- Rate limiting
- CORS configurÃ©
- Helmet pour les headers
- Sessions sÃ©curisÃ©es

### Exemple de validation
```typescript
import { z } from 'zod';

const schemaUtilisateur = z.object({
  nom: z.string().min(2).max(50),
  email: z.string().email(),
  motDePasse: z.string().min(8)
});

export const validerUtilisateur = (donnees: unknown) => {
  return schemaUtilisateur.parse(donnees);
};
```

## ğŸ“ DOCUMENTATION

- Commentaires JSDoc pour les fonctions publiques
- README Ã  jour avec les instructions
- Documentation API avec exemples
- Changelog pour les versions

---

**Rappel**: Ce projet utilise ES2023 avec ESM uniquement. Aucun CommonJS n'est autorisÃ©.