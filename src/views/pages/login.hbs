{{!-- src/views/pages/login.hbs --}}

{{#section 'head'}}
<meta name="page-type" content="login">
{{/section}}

<section class="login-page">
    {{!-- ========== MODAL DE CONNEXION - PREMIÈRE MODAL ========== --}}
    {{!-- 
     * ID : loginModal - Modal de connexion principale
     * RELATION : Utilise les fonctions showLoginModal() et showRegisterModal() définies lignes 92-100
     * CSS UTILISÉ : Classes .login-modal-container, .login-modal-content, .login-modal-body (définies dans auth.css)
     * CONFLIT : Cette modal entre en conflit avec la modal bienvenue créée dynamiquement dans header.js
     * PROBLÈME : Navigation vers modal d'inscription via le lien "S'inscrire" ligne 40
     --}}
    <div class="login-modal-container" id="loginModal">
        <div class="login-modal-content">
            <div class="login-modal-header">
            </div>
            <div class="login-modal-body">
                <div class="login-logo">
                    <i class="fas fa-users"></i>
                </div>
                <h2 class="login-subtitle">Connecte-toi avec ton e-mail</h2>
                
                <form class="login-form" action="/auth/login" method="POST">
                    <div class="form-group">
                        <label for="email" class="form-label">Adresse e-mail</label>
                        <input type="email" id="email" name="email" class="form-input" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="password" class="form-label">Mot de passe</label>
                        <input type="password" id="password" name="password" class="form-input" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary login-btn">
                            <i class="fas fa-sign-in-alt"></i>
                            Se connecter
                        </button>
                    </div>
                </form>
                
                <div class="login-footer">
                    <p><a href="/auth/forgot-password" class="forgot-password-link">Mot de passe oublié ?</a></p>
                    <p>Pas encore de compte ? <a href="#" class="register-link" id="login-register-link">S'inscrire</a></p>
                </div>
            </div>
        </div>
    </div>

    {{!-- ========== MODAL D'INSCRIPTION - DEUXIÈME MODAL ========== --}}
    {{!-- 
     * ID : registerModal - Modal d'inscription avec boutons OAuth
     * RELATION : Utilise les fonctions showLoginModal() et showRegisterModal() définies lignes 92-100
     * CSS UTILISÉ : Classes .signup-oauth, .signup-separator, .signup-footer (définies dans auth.css)
     * CONFLIT : Cette modal entre en conflit avec la modal bienvenue créée dynamiquement dans header.js
     * PROBLÈME : Navigation vers modal de connexion via le lien "Se connecter" ligne 82
     * DÉCLENCHEUR : Affichée automatiquement si paramètre URL ?show=register (ligne 106-108)
     --}}
    <div class="login-modal-container" id="registerModal" style="display: none;">
        <div class="login-modal-content">
            <div class="login-modal-header">
            </div>
            <div class="login-modal-body">
                <div class="login-logo">
                    <i class="fas fa-users"></i>
                </div>
                <h2 class="login-subtitle">Rejoins-nous !</h2>
                
                {{!-- Boutons OAuth pour l'inscription --}}
                <div class="signup-oauth">
                    <button class="btn btn-google" id="register-oauth-google">
                        <span class="google-logo" aria-hidden="true"></span> 
                        Continuer avec Google
                    </button>
                    <button class="btn btn-apple" id="register-oauth-apple">
                        <i class="fab fa-apple" aria-hidden="true"></i> 
                        Continuer avec Apple
                    </button>
                    <button class="btn btn-facebook" id="register-oauth-facebook">
                        <i class="fab fa-facebook" aria-hidden="true"></i> 
                        Continuer avec Facebook
                    </button>
                </div>

                {{!-- Séparateur --}}
                <div class="signup-separator" aria-hidden="true">
                    Ou inscris-toi avec <a href="#" id="register-email-link">ton adresse e-mail</a>
                </div>

                {{!-- Pied de page --}}
                <div class="signup-footer" style="margin-top:1rem; text-align:center;">
                    <p style="margin: 0; color: #9cafbd; font-size: 0.9rem;">
                        Tu as déjà un compte ? 
                        <a href="#" id="register-login-link">Se connecter</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
/* ========== FONCTIONS DE NAVIGATION ENTRE MODALES - CONFLIT AVEC HEADER.JS ========== */
/* 
 * FONCTIONS : showRegisterModal() et showLoginModal() - Navigation entre les 2 modales de la page
 * RELATION : Ces fonctions sont appelées par les liens de navigation lignes 40 et 82
 * CONFLIT MAJEUR : Ces fonctions ont les mêmes noms que celles dans header.js mais font des choses différentes
 * PROBLÈME : showRegisterModal() dans header.js redirige, ici elle affiche une modal
 * DANGER : Confusion entre redirection (header.js) et affichage de modal (login.hbs)
 */
// Script pour gérer l'affichage des modals
function showRegisterModal() {
    document.getElementById('loginModal').style.display = 'none';
    document.getElementById('registerModal').style.display = 'block';
}

function showLoginModal() {
    document.getElementById('registerModal').style.display = 'none';
    document.getElementById('loginModal').style.display = 'block';
}

/* ========== GESTION DES ÉVÉNEMENTS ET PARAMÈTRES URL ========== */
/* 
 * FONCTION : Event listeners pour la gestion des modales et des boutons OAuth
 * RELATION : Utilise les fonctions showRegisterModal() et showLoginModal() définies lignes 115-123
 * PROBLÈME : Gestion du paramètre URL ?show=register qui peut créer des boucles infinies
 * CONFLIT : Les boutons OAuth redirigent vers /auth/{provider} comme dans header.js
 */
// Gestion des boutons OAuth pour la modal d'inscription
document.addEventListener('DOMContentLoaded', function() {
    // Afficher la modal d'inscription si le paramètre show=register est présent
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('show') === 'register') {
        showRegisterModal();
    }
    
    // Event listeners pour les liens de navigation entre modals
    const loginRegisterLink = document.getElementById('login-register-link');
    const registerLoginLink = document.getElementById('register-login-link');
    
    if (loginRegisterLink) {
        loginRegisterLink.addEventListener('click', (e) => {
            e.preventDefault();
            showRegisterModal();
        });
    }
    
    if (registerLoginLink) {
        registerLoginLink.addEventListener('click', (e) => {
            e.preventDefault();
            showLoginModal();
        });
    }
    
    // Boutons OAuth de la modal d'inscription
    const registerGoogleBtn = document.getElementById('register-oauth-google');
    const registerAppleBtn = document.getElementById('register-oauth-apple');
    const registerFacebookBtn = document.getElementById('register-oauth-facebook');
    const registerEmailLink = document.getElementById('register-email-link');

    if (registerGoogleBtn) {
        registerGoogleBtn.addEventListener('click', (e) => { 
            e.preventDefault();
            window.location.href = '/auth/google'; 
        });
    }
    if (registerAppleBtn) {
        registerAppleBtn.addEventListener('click', (e) => { 
            e.preventDefault();
            window.location.href = '/auth/apple'; 
        });
    }
    if (registerFacebookBtn) {
        registerFacebookBtn.addEventListener('click', (e) => { 
            e.preventDefault();
            window.location.href = '/auth/facebook'; 
        });
    }
    if (registerEmailLink) {
        registerEmailLink.addEventListener('click', (e) => {
            e.preventDefault();
            window.location.href = '/auth/register';   // ou '/auth/login?mode=email'
            // Reste dans la modal "Rejoins-nous !"
        });
    }
});
</script>

